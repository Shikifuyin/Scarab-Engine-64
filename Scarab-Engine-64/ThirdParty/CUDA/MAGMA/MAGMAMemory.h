/////////////////////////////////////////////////////////////////////////////////
// File : MAGMAMemory.h
/////////////////////////////////////////////////////////////////////////////////
// Version : 0.1
// Status : Alpha
/////////////////////////////////////////////////////////////////////////////////
// Description : MAGMA Memory Containers
/////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////
// Known Bugs : None
/////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////
// Header prelude
#ifndef MATRIXSIMULATION_CUDA_MAGMA_MAGMAMEMORY_H
#define MATRIXSIMULATION_CUDA_MAGMA_MAGMAMEMORY_H

/////////////////////////////////////////////////////////////////////////////////
// Includes
#include "MAGMAMappings.h"

/////////////////////////////////////////////////////////////////////////////////
// Constants definitions

/////////////////////////////////////////////////////////////////////////////////
// The MAGMAMemory class
class MAGMAMemory
{
public:
	MAGMAMemory();
	virtual ~MAGMAMemory();
	
	virtual Bool IsHostMemory() const = 0;
	virtual Bool IsDeviceMemory() const = 0;

	inline Bool IsAllocated() const;
	inline Bool HasOwnerShip() const;
	
	inline SizeT GetSize() const;
	inline Void * GetPointer();
	inline const Void * GetPointer() const;
	
protected:
	Bool m_bHasOwnerShip;
	SizeT m_iSize;
	Void * m_pMemory;
};

/////////////////////////////////////////////////////////////////////////////////
// The MAGMAHostMemory class
class MAGMAHostMemory : public MAGMAMemory
{
public:
	MAGMAHostMemory();
	virtual ~MAGMAHostMemory();
	
	inline virtual Bool IsHostMemory() const;
	inline virtual Bool IsDeviceMemory() const;

	Void Allocate( SizeT iSize );		// 64-byte boundary aligned
	Void AllocatePinned( SizeT iSize ); // Page-Locked
	Void Free();
	
protected:
	Bool m_bIsPinned;
};

/////////////////////////////////////////////////////////////////////////////////
// The MAGMADeviceMemory class
class MAGMADeviceMemory : public CUDAMemory
{
public:
	MAGMADeviceMemory();
	virtual ~MAGMADeviceMemory();
	
	inline virtual Bool IsHostMemory() const;
	inline virtual Bool IsDeviceMemory() const;

	Void Allocate( SizeT iSize );
	Void Free();
	
protected:
};

/////////////////////////////////////////////////////////////////////////////////
// Backward Includes (Inlines & Templates)
#include "MAGMAMemory.inl"

/////////////////////////////////////////////////////////////////////////////////
// Header end
#endif // MATRIXSIMULATION_CUDA_MAGMA_MAGMAMEMORY_H


